<!doctype html>
<html>
    <head>
        <script src="maze.js"></script>
        <script src="circmaze.js"></script>
        <script src="generator.js"></script>
        <script src="dfs.js"></script>
        <script src="prim.js"></script>
        <script src="krushkal.js"></script>
        <script>
            function drawMaze(canvas, maze) {
                var ctx = canvas.getContext("2d");
            
                ctx.fillStyle = '#eee';
                ctx.strokeStyle = '#000';
                ctx.textAlign = 'center';
                ctx.textBaseline = 'middle';
                ctx.font = 'italic 12px sans-serif';
                ctx.fillRect(0, 0, canvas.width, canvas.height);
                ctx.fillStyle = '#000';
            
                maze.paint(ctx);
            }

            function createMazeAndCanvas(div, algorithm, radius) {
                var canvas = div.getElementsByTagName('canvas')[0];
            
                maze = new CircMaze(canvas.width / 2, canvas.height / 2, Math.min(canvas.width, canvas.height) - 4, 80, 5);
                //maze._rings[maze._rings.length - 5]._cells.forEach(function(cell) {
                //    var neighbours = cell.getAllNeighbours();
                //    console.log(cell.toString() + "->" + neighbours[0].toString() + ": " + cell.wallIsMine(neighbours[0]));
                //    console.log(cell.toString() + "->" + neighbours[1].toString() + ": " + cell.wallIsMine(neighbours[1]));
                //});
            
                var headline = document.createElement('h3');
                headline.appendChild(document.createTextNode(algorithm.name));
            
            
                div.appendChild(headline);
                //div.appendChild(canvas);
                algorithm.initialize(maze);
            

                return {
                    'div' : div,
                    'canvas' : canvas,
                    'maze' : maze,
                    'headline' : headline,
                    'radius' : radius,
                    'algorithm' : algorithm
                };
            }
            
            function createMaze(div, algorithm, radius) {
                var obj = createMazeAndCanvas(div, algorithm, radius);
                obj.algorithm.generate(obj.maze);
                drawMaze(obj.canvas, obj.maze);
            }

            function startMaze() {
                var objs = [
                    //createMazeAndCanvas(document.getElementById("prim"), new PrimMazeGenerator(), 10),
                    createMazeAndCanvas(document.getElementById("krushkal"), new DFSMazeGenerator(), 10)
                    //createMazeAndCanvas(document.getElementById("dfs"), new DFSMazeGenerator(), 10)
                ];
                objs.forEach(function(o) {
                    drawMaze(o.canvas, o.maze);
                });

                var interval = undefined;

                var nextStep = function() {
                    var madeStep = false;
                    var stepsToDo = 100;
                    for (var i = 0; madeStep === false && i < objs.length; i++) {
                        var obj = objs[i];
                        for (var j = 0; j < stepsToDo && obj.algorithm.step(); j++) {
                            madeStep = true;
                        }
                        if (madeStep) {
                            drawMaze(obj.canvas, obj.maze);
                        }
                    }
                    if (!madeStep) {
                        clearInterval(interval);
                    }
                };

                interval = setInterval(nextStep, 50);
            }
        </script>
        <style>
            .maze {
                float: left;
                margin-left: 10px;
                width: 480px;
                height: 620px;
            }
        </style>
    </head>
    <body onLoad="startMaze();">
        <!--div class="maze" id="prim"><canvas width="460px" height="600px" class="mazeCanvas"></canvas></div-->
        <div class="maze" id="krushkal"><canvas width="1200px" height="1200px" class="mazeCanvas"></canvas></div>
        <!--div class="maze" id="dfs"><canvas width="460px" height="600px" class="mazeCanvas"></canvas></div-->
    </body>
</html>
