<!doctype html>
<html>
    <head>
        <script src="maze.js"></script>
        <script src="hexmaze.js"></script>
        <script src="generator.js"></script>
        <script src="dfs.js"></script>
        <script src="prim.js"></script>
        <script src="krushkal.js"></script>
        <script>
            var interval;
            function drawMaze(canvas, maze) {
                var ctx = canvas.getContext("2d");
            
                ctx.fillStyle = '#eee';
                ctx.strokeStyle = '#000';
                ctx.textAlign = 'center';
                ctx.textBaseline = 'middle';
                ctx.font = 'italic 12px sans-serif';
                ctx.fillRect(0, 0, canvas.width, canvas.height);
                ctx.fillStyle = '#000';
            
                maze.paint(ctx);
            }

            function createMazeAndCanvas(div, algorithm, radius) {
                var canvas = div.getElementsByTagName('canvas')[0];
                var halfHeight = Math.sin(HexMaze.PI2_6) * radius;
                var cols = Math.floor((canvas.width - radius*7) / (radius * 2.5));
                var rows = Math.floor((canvas.height - halfHeight) / halfHeight);
            
                maze = new HexMaze(rows, cols, radius);
            
                var headline = document.createElement('h3');
                headline.appendChild(document.createTextNode(algorithm.name));
            
                //canvas.setAttribute('width', "" + div.offsetWidth);
                //canvas.setAttribute('height', "" + div.offsetHeight);
            
                div.appendChild(headline);
                div.appendChild(canvas);
                algorithm.initialize(maze);
            

                return {
                    'div' : div,
                    'canvas' : canvas,
                    'maze' : maze,
                    'headline' : headline,
                    'radius' : radius,
                    'algorithm' : algorithm
                };
            }
            
            function createMaze(div, algorithm, radius) {
                var obj = createMazeAndCanvas(div, algorithm, radius);
                obj.algorithm.generate(obj.maze);
                drawMaze(obj.canvas, obj.maze);
            }

            function startMaze() {
                var objs = [
                    //createMazeAndCanvas(document.getElementById("prim"), new PrimMazeGenerator(), 10),
                    createMazeAndCanvas(document.getElementById("krushkal"), new KrushkalMazeGenerator(), 10)
                    //createMazeAndCanvas(document.getElementById("dfs"), new DFSMazeGenerator(), 10)
                ];
                objs.forEach(function(o) {
                    drawMaze(o.canvas, o.maze);
                });

                var interval = undefined;

                var nextStep = function() {
                    var madeStep = false;
                    var stepsToDo = 5;
                    for (var i = 0; madeStep === false && i < objs.length; i++) {
                        var obj = objs[i];
                        for (var j = 0; j < stepsToDo && obj.algorithm.step(); j++) {
                            madeStep = true;
                        }
                        if (madeStep) {
                            drawMaze(obj.canvas, obj.maze);
                        }
                    }
                    if (!madeStep) {
                        clearInterval(interval);
                        alert("Done");
                    }
                };

                interval = setInterval(nextStep, 50);
            }
        </script>
        <style>
            .maze {
                float: left;
                margin-left: 10px;
                width: 480px;
                height: 620px;
            }
        </style>
    </head>
    <body onLoad="startMaze();">
        <div class="maze" id="prim"><canvas width="460px" height="600px" class="mazeCanvas"></canvas></div>
        <div class="maze" id="krushkal"><canvas width="460px" height="600px" class="mazeCanvas"></canvas></div>
        <div class="maze" id="dfs"><canvas width="460px" height="600px" class="mazeCanvas"></canvas></div>
    </body>
</html>
